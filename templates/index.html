<!DOCTYPE HTML>
<!--
	Dimension by HTML5 UP
	html5up.net | @ajlkn
	Free for personal and commercial use under the CCA 3.0 license (html5up.net/license)
-->
<html>
	<head>
		<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-9ndCyUaIbzAi2FUVXJi0CjmCapSmO7SnpJef0486qhLnuZ2cdeRhO02iuK6FUUVM" crossorigin="anonymous">

		<script type="text/javascript" src="https://cdn.datatables.net/1.10.25/js/dataTables.bootstrap5.min.js"></script>
		<title>Server Autom</title>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />

		<link rel="stylesheet" href="{{ url_for('static', filename='css/main.css') }}">
        <noscript><link rel="stylesheet" href="{{ url_for('static', filename='css/noscript.css') }}" /></noscript>
		<script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.7.2/socket.io.js" ></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.0/jquery.min.js" ></script>

	</head>

	<body class="is-preload">

		<!-- Wrapper -->
			<div id="wrapper">

				<!-- Header -->
					<header id="header">
						<div class="logo">
							<span class="icon fa-gem"></span>
						</div>
						<div class="content">
							<div class="inner">
								<h1>Domovní Informační Systém</h1>

							</div>
						</div>
						<nav>
							<ul>
								<li><a href="#elektrina">Elektřina</a></li>
								<li><a href="#ovl">Ovládání</a></li>
								<li><a href="#kamery">Kamery</a></li>
								<li><a href="#prehled">Zařízení</a></li>

							</ul>
						</nav>
					</header>

				<!-- Main -->
					<div id="main">

						<!-- Elektroměr -->
							<article id="elektrina">
								<h2 class="major">Elektřina</h2>
										<h5>Graf spotřeby ve spodním bytě</h5>
											<div id="graph_1" class="graphs">
											  <!-- Plotly chart will be drawn inside this div -->
											</div>
											<script>
											  var graphs = {{graphJSON_1 | safe}};
											  Plotly.newPlot('graph_1',graphs.data,graphs.layout, {responsive: true});
											</script>

										<h5>Graf spotřeby v horním bytě</h5>
											<div id="graph_2" class="graphs">
											  <!-- Plotly chart will be drawn inside this div -->
											</div>
											<script>
											  var graphs = {{graphJSON_2 | safe}};
											  Plotly.newPlot('graph_2',graphs.data,graphs.layout, {responsive: true});
											</script>

										<h5>Graf spotřeby čerpadla</h5>
											<div id="graph_3" class="graphs">
											  <!-- Plotly chart will be drawn inside this div -->
											</div>
											<script>
											  var graphs = {{graphJSON_3 | safe}};
											  Plotly.newPlot('graph_3',graphs.data,graphs.layout, {responsive: true});
											</script>

							</article>

						<!-- Ovladani -->
							<article id="ovl">
								<h2 class="major">Světla</h2>
								<div class="container">


								  <div class="row">
											<h3 class="card-title">Kůlna</h3>
<!-- Light 1 -->
<div class="col-sm-4">
    <div class="card">
        <div class="card-body">
            <div class="light-switch">
                <input type="checkbox" class="btn-check light-toggle" id="light1-toggle" data-light="light1" onchange="toggleBrightness(this)">
                <label class="btn btn-outline-success" for="light1-toggle">kůlna lustr</label><br>
                <input type="range" min="0" max="254" class="slider light-slider" id="light1-slider" data-light="light1">
            </div>
        </div>
    </div>
</div>

<!-- Light 2 -->
<div class="col-sm-4">
    <div class="card">
        <div class="card-body">
            <div class="light-switch">
                <input type="checkbox" class="btn-check light-toggle" id="light2-toggle" data-light="light2" onchange="toggleBrightness(this)">
                <label class="btn btn-outline-success" for="light2-toggle">kůlna trámky</label><br>
                <input type="range" min="0" max="254" class="slider light-slider" id="light2-slider" data-light="light2">
            </div>
        </div>
    </div>
</div>

<!-- Light 3 -->
<div class="col-sm-4">
    <div class="card">
        <div class="card-body">
            <div class="light-switch">
                <input type="checkbox" class="btn-check light-toggle" id="light3-toggle" data-light="light3" onchange="toggleBrightness(this)">
                <label class="btn btn-outline-success" for="light3-toggle">kůlna pásek</label><br>
                <input type="range" min="0" max="254" class="slider light-slider" id="light3-slider" data-light="light3">
            </div>
        </div>
    </div>
</div>

<script>
    function toggleBrightness(checkbox) {
        let slider = $(checkbox).siblings('.light-slider')[0];
        if (checkbox.checked) {
            slider.value = 255;
        } else {
            slider.value = 0;
        }
        saveSliderValue(slider);
    }

    function updateLightingValue(slider) {
        let lightId = $(slider).data('light');
        $.get(`/lighting-data/${lightId}`, function(data) {
            $(slider).val(data.value);
        });
    }

    function saveSliderValue(slider) {
        let lightId = $(slider).data('light');
        let checkbox = $(slider).siblings('.light-toggle')[0];
        if (slider.value > 10) {
            checkbox.checked = true;
        } else {
            checkbox.checked = false;
        }
        $.ajax({
            url: `/lighting-data/${lightId}`,
            type: "POST",
            contentType: "application/json",
            data: JSON.stringify({ value: slider.value }),
        });
    }

    $(document).ready(function() {
        $(".light-slider").on("change", function() {
            saveSliderValue(this);
        });

        setInterval(function() {
            $(".light-slider").each(function() {
                updateLightingValue(this);
            });
        }, 5000);
    });
</script>

									<!--	
									<div class="col-sm-4">
									  <div class="card">
										<div class="card-body">
										<div class="light-switch">
											
											<input type="checkbox" class="btn-check" id="btn-check-2-outlined" checked autocomplete="off" onchange="toggleBrightness()">
											<label class="btn btn-outline-success" for="btn-check-2-outlined">Kůlna lustr</label><br>
											<input type="range" min="0" max="255" class="slider" id="dimmerSlider">
		
										</div>
							
										<script>
											    function toggleBrightness() {
													var checkbox = document.getElementById('btn-check-2-outlined');
													var slider = document.getElementById('dimmerSlider');

													if (checkbox.checked) {
														slider.value = 255; // Set brightness to maximum when checkbox is checked
													} else {
														slider.value = 0; // Set brightness to minimum when checkbox is unchecked
													}											
													saveSliderValue();
												}

											function updateLightingValue() {

												$.get("/lighting-data", function(data) {
													$("#dimmerSlider").val(data.value);
												});
											}
										
											function saveSliderValue() {
											var checkbox = document.getElementById('btn-check-2-outlined');
											var slider = document.getElementById('dimmerSlider');
																						
											if (slider.value > 10) {
												checkbox.checked = true; // Check the checkbox if slider value is greater than 10
											} else {
												checkbox.checked = false; // Uncheck the checkbox if slider value is 10 or less
											}

											$.ajax({
												url: "/lighting-data",
												type: "POST",
												contentType: "application/json",
												data: JSON.stringify({ value: slider.value }),
											});
										}
								
											// Add an event listener to the slider to detect changes
											$("#dimmerSlider").on("change", saveSliderValue);
											setInterval(updateLightingValue, 5000);

										</script>
								</div>
								</div>
								</div>
			
									<!-- You can add more control sections for Cameras and Others here. -->


								  </div>
								</div>


							</article>

						<!-- Kamery -->
							<article id="kamery">
								<h2 class="major">Kamery</h2>
									{% for camera in cameras %}

											<h3>{{ camera.name }}</h3>
																		<div class="video-container">
											<img class="camera-feed" src="{{ url_for('video_feed_' + camera.id) }}" alt="" onclick="zoomImage(this)">
										</div>
									{% endfor %}
							</article>

						<!-- Zařízení -->
							<article id="prehled">
								<h2 class="major">Přehled systému</h2>
									<div class="container">


										<!-- Teploměry -->
										<h4 class="nadpis-sekce">Teploměry</h4>
										<div class="row">
											<!-- Placeholder for Power Meters Chart -->
											{% for thermo in t %}
											<div class="col-sm-4">
												<div class="card">
													<div class="card-body">
														<h5 class="card-title">{{ thermo.name }}</h5>
														<p class="card-text">Aktuální hodnoty: {{ thermo.values }} {{ thermo.units }} </p>
													</div>
												</div>
											</div>
											{% endfor %}
										</div>

										<!-- Elektroměry -->
										<h4 class="nadpis-sekce">Elektroměry</h4>
										<div class="row">
											<!-- Placeholder for Power Meters Chart -->
											{% for elektro in e %}
											<div class="col-sm-4">
												<div class="card">
													<div class="card-body">
														<h5 class="card-title">{{ elektro.name }}</h5>
														<p class="card-text">Aktuální hodnoty: {{ elektro.values }} {{ elektro.units }} </p>
													</div>
												</div>
											</div>
											{% endfor %}
										</div>

										<!-- Kamery -->
										<h4 class="nadpis-sekce">Kamery</h4>
										<div class="row">
											<!-- Placeholder for Power Meters Chart -->
											{% for cam in cameras %}
											<div class="col-sm-4">
												<div class="card">
													<div class="card-body">
														<h5 class="card-title">{{ cam.name }}</h5>
														<img class="video-mini" src="{{ url_for('video_feed_' + cam.id) }}" alt="">
													</div>
												</div>
											</div>
											{% endfor %}
										</div>


									</div>
							</article>
					</div>

				<!-- Footer -->
					<footer id="footer">
						<p class="copyright">&copy; Untitled. Design: <a href="https://html5up.net">HTML5 UP</a>.</p>
					</footer>

			</div>

		<!-- BG -->
			<div id="bg"></div>

		<!-- Scripts -->


            <script src="{{ url_for('static', filename='js/jquery.min.js') }}"></script>
            <script src="{{ url_for('static', filename='js/browser.min.js') }}"></script>
            <script src="{{ url_for('static', filename='js/breakpoints.min.js') }}"></script>
            <script src="{{ url_for('static', filename='js/util.js') }}"></script>
            <script src="{{ url_for('static', filename='js/main.js') }}"></script>

	    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js" integrity="sha384-geWF76RCwLtnZ8qwWowPQNguL3RmwHVBC9FhGdlKrxdiJJigb/j/68SIy3Te4Bkz" crossorigin="anonymous"></script>


	</body>
</html>
